<!doctype html><html class="not-ready lg:text-base" lang=en dir=ltr><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Tracing - Lalit Maganti</title><meta name=theme-color><meta name=description content="A personal blog"><meta name=author content="Lalit Maganti"><link rel="preload stylesheet" as=style href=https://lalitm.com/main.min.css><link rel=preload as=image href=https://lalitm.com/theme.png><link rel=preload as=image href=https://lalitm.com/github.svg><link rel=preload as=image href=https://lalitm.com/linkedin.svg><link rel=preload as=image href=https://lalitm.com/rss.svg><link rel=icon href=https://lalitm.com/favicon.ico><link rel=apple-touch-icon href=https://lalitm.com/apple-touch-icon.png><meta name=generator content="Hugo 0.152.2"><link rel=preconnect href=https://www.googletagmanager.com crossorigin><link rel=dns-prefetch href=https://www.google-analytics.com><script async src="https://www.googletagmanager.com/gtag/js?id=G-CPF1NN7N28"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CPF1NN7N28",{anonymize_ip:!0,cookie_flags:"SameSite=None;Secure"})</script><meta itemprop=name content="Tracing"><meta itemprop=datePublished content="2025-10-31T00:00:00+00:00"><meta itemprop=dateModified content="2025-10-31T00:00:00+00:00"><meta property="og:url" content="https://lalitm.com/tags/tracing/"><meta property="og:site_name" content="Lalit Maganti"><meta property="og:title" content="Tracing"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tracing"><link rel=alternate type=application/rss+xml href=https://lalitm.com/tags/tracing/index.xml title="Lalit Maganti"><link rel=canonical href=https://lalitm.com/tags/tracing/></head><body class="text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"><div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto"><a class="-translate-y-[1px] text-2xl font-medium" href=https://lalitm.com/>Lalit Maganti</a></div><div class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]');metaTheme.setAttribute("content","#000"),htmlClass.add("dark")</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center rtl:space-x-reverse header-nav"><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/page/about/>About</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/page/archive/>Archive</a><a class="block text-center text-xl leading-[5rem] lg:text-base lg:font-normal" href=/page/subscribe/>Subscribe</a></nav><nav class="mt-12 flex justify-center space-x-10 lg:mt-0 lg:items-center ltr:lg:ml-14 rtl:space-x-reverse rtl:lg:mr-14 dark:invert"><a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/LalitMaganti target=_blank rel=me>github</a>
<a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./linkedin.svg) href=https://linkedin.com/in/lalit-maganti-18b73a9a target=_blank rel=me>linkedin</a>
<a class="h-7 w-7 text-[0px] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=https://lalitm.com/index.xml target=_blank rel=alternate>rss</a></nav></div></header><main class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-0 pb-16 main-content"><article><header class=taxonomy-header><h1 class="!mt-0 !text-base !font-bold taxonomy-title">Posts with tag: "<span class=archive-tag-link>Tracing</span>"</h1><div class="text-sm opacity-60">1 post matches this tag</div></header><div class=taxonomy-post-list><article class="taxonomy-post-item mb-2 pb-2 mt-2"><h1 class="!mt-1 !mb-1 !text-base !font-bold"><a href=https://lalitm.com/perfetto-swiss-army-knife/ class="!text-black dark:!text-white !no-underline hover:!underline">Perfetto: Swiss Army Knife for Linux Client Tracing</a></h1><time class="block text-xs taxonomy-post-date">Oct 31, 2025</time><div><p>I gave a talk at the <a href=https://tracingsummit.org/>2025 Tracing Summit</a> last month titled &ldquo;<a href=https://cfp.tracingsummit.org/ts2025/talk/TKVU8W/>Perfetto: The Swiss Army Knife of Linux Client/Embedded Tracing</a>&rdquo;. My goal in this talk was to show how Linux kernel, systems and embedded developers can use <a href=https://docs.perfetto.dev>Perfetto</a> when debugging and root-causing performance issues in their respective domains. Even though the Perfetto UI is primarily built for viewing <a href=https://perfetto.dev/docs/#why-would-you-use-perfetto->Android or Chrome traces</a>, it is a flexible tool and can be used in many other ways!</p><p>The talk was recorded and is available on <a href="https://www.youtube.com/watch?v=VzTwul2Qb3g">YouTube</a>. Taking inspiration from <a href=https://simonwillison.net/>Simon Willison</a>, this post is an <a href=https://simonwillison.net/2023/Aug/6/annotated-presentations/>annotated presentation</a> containing my slides and detailed notes on them. The talk also has a lot of UI demos: for these, I&rsquo;ll have a screenshot but also a link to the relevant part of the video (videos are unbeatable for UI!).</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%><iframe style=position:absolute;top:0;left:0;width:100%;height:100% src=https://www.youtube.com/embed/VzTwul2Qb3g title="TS2025 - Perfetto: The Swiss Army Knife of Linux Client/Embedded Tracing" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy=strict-origin-when-cross-origin allowfullscreen></iframe></div><hr><p>First, what is Perfetto? Perfetto is fundamentally a suite of tools: it&rsquo;s not just one thing but a bunch of different tools working together to help you debug and root-cause problems. This diagram shows how everything fits together, with the core parts of the Perfetto project in the center.</p><center><p><img src=/img/perfetto-swiss-army-03.jpg alt="diagram of all the pieces of Perfetto, Recording tools, protobuf format, trace processor, Perfetto UI, Python API, Format converters. Chrome JSON, Other profiling formats"></p></center><p>The recording tools for Perfetto consist of 1) an <a href=https://perfetto.dev/docs/getting-started/in-app-tracing>SDK for C++ apps</a> 2) a <a href=https://perfetto.dev/docs/getting-started/system-tracing>daemon</a> that can collect data from ftrace, /proc, /sys, and various kernel interfaces 3) another <a href=https://perfetto.dev/docs/concepts/service-model>daemon</a> that amalgamates trace data from multiple processes into a single trace file. These tools all speak the Perfetto <a href=https://perfetto.dev/docs/getting-started/converting>protobuf format</a>, a high-performance trace format designed to be very efficient to write but not to analyze or consume directly.</p><p>That&rsquo;s where the <a href=https://perfetto.dev/docs/analysis/trace-processor>trace processor</a> comes in. It&rsquo;s a C++ library that parses the protobuf format, but also a bunch of other widely used trace formats. It exposes this data via an SQL query interface to any embedding program including <a href=https://perfetto.dev/docs/visualization/perfetto-ui>Perfetto UI</a> (which is what most of this talk is about) and also to the <a href=https://perfetto.dev/docs/analysis/trace-processor-python>Python API</a> if you want to do ad-hoc scripting or analysis in Python.</p><p>There are also very common tracing/profiling formats used by the Linux community: perf.data, ftrace text format, Firefox profiler format, and many others. Perfetto <a href=https://perfetto.dev/docs/getting-started/other-formats>supports</a> quite a few of those directly. There&rsquo;s also the Chrome JSON format (AKA the <a href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview?tab=t.0">Trace Event Format</a>) which is a simpler interchange format. It&rsquo;s not the most efficient to read or write, but it does the job for a lot of use cases.</p><p>Often people write <a href=https://perfetto.dev/docs/getting-started/converting>converters</a>. They have their own tracing format, maybe proprietary, maybe open source but something we don&rsquo;t know about, and it&rsquo;s very common that people convert to one of the formats we understand, most commonly our protobuf or Chrome JSON formats.</p><center><p><img src=/img/perfetto-swiss-army-04.jpg alt="Slide showing Perfetto UI architecture with web-based trace visualizer features"></p></center><p>The <a href=https://perfetto.dev/docs/visualization/perfetto-ui>Perfetto UI</a> is fundamentally a web-based trace visualizer, combining timeline visualization, user-driven selection/aggregation, and SQL queries all in one interface. Because it has the trace processor as a backend, it works with a bunch of different trace formats.</p><p>It&rsquo;s very important to note that even though the Perfetto UI is web-based, everything happens inside your browser and trace data never leaves your system. You can even <a href=https://perfetto.dev/docs/contributing/ui-getting-started>build it</a> and host it yourself on any static server: we&rsquo;ve made it extremely easy to do so!</p><p>At the start of 2025, we actually moved our whole development to GitHub. In the past, we used to develop on Android and GitHub was just a mirror. That&rsquo;s no longer the case, GitHub is actually where we develop and take pull requests.</p><center><p><img src=/img/perfetto-swiss-army-05.jpg alt="Slide introducing the fractal renderer demo program with Vulkan and multi-threading"></p></center><p>Most of this talk, I&rsquo;m going to spend actually showing you how you can use the Perfetto UI to debug performance issues on Linux. I don&rsquo;t want to show you an Android trace which needs a lot of context about how the Android system works and so you think, &ldquo;oh, that was cool, but I didn&rsquo;t really understand what was happening.&rdquo;</p><p>So to make this talk more approachable, I wrote a <a href=https://github.com/LalitMaganti/fractal-renderer-vk>straightforward demo program</a> you can look at yourself! So it&rsquo;s obviously not a production system but I&rsquo;ve tried to make it as representative of the sort of issues we use Perfetto for every day.</p><p>It&rsquo;s a Rust program which generates a Julia set and visualizes it over time. The technologies I used: <a href=https://vulkano.rs/>Vulkan</a>, GPU rendering and also multi-threaded CPU computation. So how it works is that computation of various parameters is happening on background threads, and then that&rsquo;s being passed to the main thread for rendering.</p><p>And then, for demonstration purposes, there is a performance bug; rendering should run at 60 FPS, but every so often, the frame rate drops dramatically. Here&rsquo;s what that looks like:</p><center><p><img src=/img/test.avif alt="Animated visualization of Julia set fractal renderer showing frame rate drops"></p></center><p>The code is on <a href=https://github.com/LalitMaganti/fractal-renderer-vk>GitHub</a> and if you&rsquo;re interested in following along. The traces are there as well - you don&rsquo;t have to collect the traces yourself, but you can if you want. All the instructions and information is in the README.</p><center><p><img src=/img/perfetto-swiss-army-06.jpg alt="Slide titled &ldquo;Suspicion #1: Maybe it&rsquo;s a CPU problem?&rdquo; with perf command examples"></p></center><p>So the first suspicion we may have is that maybe it&rsquo;s some CPU problem. A lot of engineers I know would reach for perf immediately whenever they see a problem like this. The main reason is that if perf can capture the problem, they can go straight to the line of code without needing to spend time debugging using more complex approaches.</p><div class=continue-reading><a href=https://lalitm.com/perfetto-swiss-army-knife/ class="text-sm opacity-60 hover:opacity-100 hover:underline">Continue reading â†’</a></div></div><div class=post-metadata><a href=https://lalitm.com/perfetto-swiss-army-knife/ class=hover:underline>#</a><span> 00:00</span><span> / </span><a href=https://lalitm.com/tags/perfetto class=hover:underline>#perfetto</a><span> </span><a href=https://lalitm.com/tags/linux class=hover:underline>#linux</a><span> </span><a href=https://lalitm.com/tags/tracing class=hover:underline>#tracing</a><span> </span><a href=https://lalitm.com/tags/performance class=hover:underline>#performance</a></div></article><hr></div></article></main><footer class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"><div class=mr-auto>&copy;2025
<a class=link href=https://lalitm.com/>Lalit Maganti</a></div></footer></body></html>